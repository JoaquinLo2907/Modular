<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registro - Weeducate Parents</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: url('../../assets/img/escuela-activa.jpg') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
    }
    body::before {
      content: "";
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(3px);
    }
    .registro-container {
      background: rgba(255, 255, 255, 0.9);
      padding: 2.5rem;
      border-radius: 12px;
      box-shadow: 0px 5px 15px rgba(0,0,0,0.2);
      width: 100%; max-width: 500px;
      position: relative; z-index: 2;
      text-align: center;
    }
    .form-control { border-radius: 8px; height: 45px; border: 1px solid #d1d1d1; }
    .btn-primary {
      background-color: #4A90E2; border: none; border-radius: 8px; transition: .3s;
    }
    .btn-primary:hover { background-color: #357ABD; transform: scale(1.03); }
    .btn-secondary { background-color: #6c757d; color: #fff; border: none; border-radius: 8px; transition: .3s; }
    .btn-secondary:hover { background-color: #5a6268; transform: scale(1.03); }
  </style>
</head>
<body>
  <div class="registro-container">
    <img src="../../assets/img/LogoSchoolCare.png"
         alt="SchoolCare Logo"
         class="img-fluid mb-3"
         style="max-width: 150px; width: 100%; height: auto;">

    <h3 class="mb-3 fw-bold">Crear Cuenta</h3>
    <p class="text-muted">Llene el siguiente formulario para crear su nueva cuenta.</p>

    <form id="registerForm" action="../php/register.php" method="POST" novalidate>
      <!-- Nombre y Apellido -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="nombre" class="form-label fw-semibold">Nombre</label>
          <input type="text" class="form-control" id="nombre" name="nombre"
                 placeholder="Ej. Pedro" required>
          <div class="invalid-feedback">
            Sólo letras y espacios, mínimo 2 caracteres.
          </div>
        </div>
        <div class="col-md-6">
          <label for="apellido" class="form-label fw-semibold">Apellido</label>
          <input type="text" class="form-control" id="apellido" name="apellido"
                 placeholder="Ej. Pérez" required>
          <div class="invalid-feedback">
            Sólo letras y espacios, mínimo 2 caracteres.
          </div>
        </div>
      </div>

      <!-- Correo Electrónico -->
      <div class="mb-3">
        <label for="email" class="form-label fw-semibold">Correo Electrónico</label>
        <input type="email" class="form-control" id="email" name="email"
               placeholder="Ej. correo@seguro.com" required>
        <div class="invalid-feedback">
          Debe ser un correo electrónico válido.
        </div>
      </div>

      <!-- Contraseña -->
      <div class="mb-3">
        <label for="password" class="form-label fw-semibold">Contraseña</label>
        <input type="password" class="form-control" id="password" name="password"
               placeholder="Mínimo 8 caracteres, 1 mayúscula, 1 número" required>
        <div class="invalid-feedback">
          Debe tener mínimo 8 caracteres, al menos una mayúscula y un número.
        </div>
      </div>

      <!-- Confirmar Contraseña -->
      <div class="mb-3">
        <label for="confirmPassword" class="form-label fw-semibold">Confirmar Contraseña</label>
        <input type="password" class="form-control" id="confirmPassword"
               name="confirmPassword" placeholder="Confirma tu Contraseña" required>
        <div class="invalid-feedback">
          Las contraseñas no coinciden.
        </div>
      </div>

      <!-- Rol oculto -->
      <input type="hidden" id="rol" name="rol" value="2">

      <!-- Campos extra -->
      <div id="campos-extra" class="row mb-4">
        <div class="col-md-6">
          <label for="telefono" class="form-label fw-semibold">Número de Teléfono</label>
          <input type="text" class="form-control" id="telefono" name="telefono"
                 placeholder="Sólo dígitos, 7 - 15 caracteres" required>
          <div class="invalid-feedback">
            Sólo dígitos, entre 7 y 15 caracteres.
          </div>
        </div>
        <div class="col-md-6">
          <label for="direccion" class="form-label fw-semibold">Dirección</label>
          <textarea class="form-control" id="direccion" name="direccion"
                    rows="2" placeholder="Ej. Calle 123, Ciudad" required></textarea>
          <div class="invalid-feedback">
            La dirección debe tener al menos 5 caracteres.
          </div>
        </div>
      </div>

      <!-- Botones -->
      <button class="btn btn-primary w-100" type="submit">Registrar</button>
      <button type="button" class="btn btn-secondary w-100 mt-2"
              onclick="location.href='default-login.html'">
        Regresar
      </button>
    </form>
  </div>

  <!-- Bootstrap JS + validación -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function() {
      const form       = document.getElementById('registerForm');
      const nombreEl   = form.nombre;
      const apellidoEl = form.apellido;
      const emailEl    = form.email;
      const pwdEl      = form.password;
      const pwd2El     = form.confirmPassword;
      const telEl      = form.telefono;
      const dirEl      = form.direccion;

      form.addEventListener('submit', function(e) {
        let valid = true;

        // Nombre y Apellido: sólo letras y espacios, mínimo 2 caracteres
        const namePattern = /^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]{2,}$/;
        if (!namePattern.test(nombreEl.value.trim())) {
          valid = false;
          nombreEl.classList.add('is-invalid');
        } else {
          nombreEl.classList.remove('is-invalid');
        }
        if (!namePattern.test(apellidoEl.value.trim())) {
          valid = false;
          apellidoEl.classList.add('is-invalid');
        } else {
          apellidoEl.classList.remove('is-invalid');
        }

        // Email: validación HTML5
        if (!emailEl.checkValidity()) {
          valid = false;
          emailEl.classList.add('is-invalid');
        } else {
          emailEl.classList.remove('is-invalid');
        }

        // Contraseña: mínimo 8 caracteres, al menos una mayúscula y un número
        const pwdVal = pwdEl.value;
        const pwdPattern = /^(?=.*[A-Z])(?=.*\d).{8,}$/;
        if (!pwdPattern.test(pwdVal)) {
          valid = false;
          pwdEl.classList.add('is-invalid');
        } else {
          pwdEl.classList.remove('is-invalid');
        }

        // Confirmar contraseña
        if (pwdVal !== pwd2El.value || pwd2El.value === '') {
          valid = false;
          pwd2El.classList.add('is-invalid');
        } else {
          pwd2El.classList.remove('is-invalid');
        }

        // Teléfono: sólo dígitos, entre 7 y 15 caracteres
        if (!/^\d{7,15}$/.test(telEl.value.trim())) {
          valid = false;
          telEl.classList.add('is-invalid');
        } else {
          telEl.classList.remove('is-invalid');
        }

        // Dirección: mínimo 5 caracteres
        if (dirEl.value.trim().length < 5) {
          valid = false;
          dirEl.classList.add('is-invalid');
        } else {
          dirEl.classList.remove('is-invalid');
        }

        if (!valid) {
          e.preventDefault();
          e.stopPropagation();
          // Opcional: mostrar un toast de SweetAlert2
          Swal.fire({
            icon: 'error',
            title: 'Corrige los campos marcados',
            timer: 2000,
            showConfirmButton: false
          });
        }
      });
    })();
  </script>
</body>
</html>
